<div class="container" fade-in={duration:200}>
    <div class="row">

        <div class="col-md-12">
            <h1 style="padding-top:30px; padding-bottom:0px;">Basic <span class="highlightLetter">Ajax</span></h1>
        </div>
    </div>
    
     <div class="row">

        <div class="col-md-12">
            <p>In this demo, we show how to perform an Ajax call to fetch data for the view.</p>
            <p>Below is the response returned from the Ajax request:</p>
            
            <pre><code  class="line-numbers language-js">{{response}}</code></pre>
        </div>
    </div>
	
	 <div class="row">
        <div class="col-md-12">
			<p>
				Use the button below to test again!
			</p>
            <button class="btn btn-success" on-click="@.reload()">Reload View</button>
			<div class="checkbox">
				<label><input type="checkbox" checked="{{ajaxOptions.throwError}}">Throw error?</label>
			</div>
        </div>
    </div>

    <div class="row">

        <div class="col-md-12">
            <p>Often a view is dependent on data that needs to be fetched from a server. In these scenarios we need to fetch the data <span class="var">before</span>
				we transition to the target route. If an error occurs while fetching the data the user will still be at the current route and can try to transition
				again.
			</p>
			
			<p>While fetching the data we generally show a loading indicator so the user can see the application is busy. In this example we use 
				<a href="http://github.hubspot.com/pace/docs/welcome/" target="_blank">Pace.js</a>, which displays a small loading bar at the top of the screen.
			</p>

            <p>
                Below is the code:
            </p>

            <pre><code  class="line-numbers language-js"> var route = {
	
	beforeenter: function ( route, prevRoute, options ) {
		// We use jQuery to call ajax
		// Return promise from beforeenter so that Journey waits for the Ajax call to resolve before calling 'enter'
		let id = 10;
		return $.getJSON( "service/person/' + id ).then( function ( response ) {
			route.data = JSON.stringify( response );

		} ).catch( ( err ) => {
			route.data = "Could not load data for BasicAjax: [" + err.status + ":" + err.statusText + "]";
		} );
	},

	enter: function ( route, prevRoute, options ) {
		// route.data contains the data loaded in 'beforeenter'
	};
}); </code></pre>
            
             <p>In <span class="ln">line 3</span> we create a ES6 Promise, which receives the <span class="var">resolve</span> and 
                <span class="var">reject</span> callbacks.</p>
            <p>In <span class="ln">line 5</span>, we use jQuery to fetch a <span class="var">JSON</span> file from the server. Once
                the Ajax request is completed, it passes in the response, <span class="var">data</span>.</p>
            <p><span class="ln">Line 6</span> creates the view and passes the data to render.</p>
            <p>Finally in <span class="ln">line 7</span> the promise is <span class="var">resolved</span>, passing the view as argument.</p>
            <p>If the Ajax call failed for some reason, <span class="ln">line 9</span> <span class="var">rejects</span> the promise, 
                and the view is not rendered, in other words, we stay at the current view.</p>
            
        </div>
    </div>
</div>